# PDF 查看器故障排除指南

## 问题：PDF.js 查看器显示但内容为空（0/0 页面）

### 症状
- PDF.js 查看器界面正常显示
- 工具栏可见（搜索、缩放等）
- 但显示 "0 / 0" 页面
- 内容区域空白

### 可能原因

#### 1. 代理服务器未运行或无法访问

**检查方法**：
```bash
# 在浏览器访问
http://localhost:5000/health
```

**解决方案**：
```bash
# 启动代理服务器
python backend_proxy.py
```

#### 2. PDF.js 查看器无法通过代理加载 PDF

PDF.js 官方查看器可能对通过代理加载的 PDF 有限制。

**检查方法**：
1. 打开浏览器控制台（F12）
2. 查看 Network 标签
3. 检查是否有失败的请求

**解决方案 A：直接测试代理 URL**

在浏览器中直接访问代理 URL（从控制台复制）：
```
http://localhost:5000/pdf-proxy?url=PDF_URL
```

如果这个 URL 能直接下载或显示 PDF，说明代理工作正常，问题在 PDF.js 查看器。

**解决方案 B：使用本地 PDF.js**

如果官方查看器有问题，可以考虑：
1. 下载 PDF.js 到本地
2. 在本地部署查看器
3. 使用本地查看器

#### 3. CORS 问题

即使通过代理，PDF.js 查看器本身可能也有 CORS 限制。

**检查方法**：
- 查看浏览器控制台的 CORS 错误

**解决方案**：
- 确保代理服务器设置了正确的 CORS 头
- 检查 `backend_proxy.py` 中的 CORS 配置

#### 4. URL 编码问题

**检查方法**：
- 查看控制台输出的 URL
- 检查 URL 是否正确编码

**解决方案**：
- 确保使用 `encodeURIComponent` 正确编码 URL

## 快速诊断步骤

### 步骤 1：检查代理服务器

```bash
# 终端 1：启动代理
python backend_proxy.py

# 终端 2：测试健康检查
curl http://localhost:5000/health
# 应该返回: {"status": "ok", "service": "PDF Proxy"}
```

### 步骤 2：测试代理端点

选择一个报告，从浏览器控制台复制"代理 URL"，然后在浏览器中直接访问。

如果能看到 PDF，说明代理工作正常。

### 步骤 3：检查查看器 URL

在浏览器控制台查看"查看器 URL"，复制并在新标签页打开。

如果查看器能加载 PDF，说明 URL 构建正确。

### 步骤 4：检查网络请求

1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 选择报告
4. 查看是否有失败的请求
5. 检查请求的 URL 和响应

## 临时解决方案

如果 PDF.js 查看器无法正常工作，可以使用：

### 方案 1：直接在新窗口打开

点击"新窗口打开"按钮，直接打开原始 PDF URL。

### 方案 2：使用代理直接下载

通过代理 URL 直接下载 PDF：
```
http://localhost:5000/pdf-proxy?url=PDF_URL
```

### 方案 3：回退到之前的 PDF.js 渲染方案

如果需要，可以回退到之前直接使用 PDF.js 库渲染的方案（不通过查看器）。

## 常见错误信息

### "代理服务器不可用"
- **原因**：代理服务器未运行或端口不对
- **解决**：启动 `python backend_proxy.py`

### "Failed to load PDF"
- **原因**：PDF 文件无法加载
- **解决**：检查 PDF URL 是否正确，代理是否正常工作

### "CORS policy"
- **原因**：跨域限制
- **解决**：确保代理服务器设置了 CORS 头

## 调试技巧

1. **启用详细日志**：查看浏览器控制台的所有输出
2. **检查 Network 标签**：查看所有网络请求和响应
3. **测试代理端点**：直接访问代理 URL 验证功能
4. **检查控制台错误**：查看 JavaScript 错误信息

## 下一步

如果以上方法都无法解决问题，请：
1. 收集浏览器控制台的完整日志
2. 收集 Network 标签的请求/响应信息
3. 提供具体的错误信息
4. 说明使用的 PDF URL 示例

