# PDF 查看器使用指南

## 问题说明

某些网站（如 `pdf.dfcfw.com`）设置了安全策略（X-Frame-Options、CSP 等），阻止 PDF 在 iframe 中嵌入显示。这导致：

- ✅ 在 HTML 页面中直接点击链接：可以正常打开（新窗口）
- ❌ 在应用中使用 iframe：被安全策略阻止

## 解决方案

我们已经实现了多种解决方案，确保用户始终可以查看 PDF：

### 1. 自动检测和提示

- 应用会自动检测 PDF 是否被阻止
- 如果检测到被阻止，会显示友好的提示信息
- 提供"在新窗口打开"按钮

### 2. 多种打开方式

#### 方式一：左侧目录操作
- **左键点击**：在右侧 iframe 中尝试显示（如果被阻止会提示）
- **右键点击**：直接在新窗口打开
- **悬停显示按钮**：鼠标悬停在报告项上，点击右上角的链接图标

#### 方式二：PDF 查看器操作
- **"新窗口打开"按钮**：始终可用，直接在新标签页打开 PDF
- **"下载"按钮**：下载 PDF 文件
- **"全屏"按钮**：仅在 iframe 成功加载时可用

### 3. 智能降级策略

1. **优先使用 iframe**：尝试在页面中内嵌显示
2. **检测阻止状态**：自动检测是否被安全策略阻止
3. **显示提示**：如果被阻止，显示清晰的提示和操作按钮
4. **备选方案**：提供新窗口打开功能

## 使用建议

### 推荐方式

对于网络 PDF 链接（如 `https://pdf.dfcfw.com/...`），推荐使用：

1. **直接在新窗口打开**：
   - 点击左侧报告项右上角的链接图标
   - 或右键点击报告项
   - 或点击 PDF 查看器中的"新窗口打开"按钮

2. **下载后查看**：
   - 点击"下载"按钮下载 PDF
   - 使用本地 PDF 阅读器打开

### 本地 PDF 文件

如果 PDF 文件在本地（如 `public/pdfs/` 目录），iframe 通常可以正常工作。

## 技术实现

### 检测机制

1. **内容检测**：检查 iframe 内容是否包含阻止提示关键词
2. **跨域检测**：尝试访问 iframe 内容，捕获跨域错误
3. **超时检测**：设置 3 秒超时，如果无法访问则认为被阻止

### 关键词检测

自动检测以下关键词来判断是否被阻止：
- 访问受限
- 安全策略
- X-Frame-Options
- refused to connect
- blocked
- EdgeOne

## 常见问题

### Q: 为什么在 HTML 页面可以打开，但在应用中不行？

**A**: HTML 页面直接打开链接是在新窗口打开，不受 iframe 限制。应用中使用 iframe 嵌入时，会被网站的安全策略阻止。

### Q: 如何确保总是能查看 PDF？

**A**: 使用"新窗口打开"功能，这是最可靠的方式，不受任何安全策略限制。

### Q: 可以禁用安全策略吗？

**A**: 不可以。这是网站设置的安全策略，客户端无法绕过。我们提供的"新窗口打开"功能可以完美解决这个问题。

### Q: 为什么有些 PDF 可以在 iframe 中显示，有些不行？

**A**: 这取决于 PDF 所在网站是否设置了阻止 iframe 嵌入的策略。大多数公开的 PDF 链接都允许嵌入，但某些网站（如东方财富）会阻止。

## 更新日志

### v1.1.0 (当前版本)
- ✅ 添加自动检测 iframe 阻止状态
- ✅ 添加"新窗口打开"功能
- ✅ 添加友好的错误提示
- ✅ 在报告目录中添加快速打开按钮
- ✅ 支持右键点击在新窗口打开

### v1.0.0
- ✅ 基础 iframe PDF 查看功能

