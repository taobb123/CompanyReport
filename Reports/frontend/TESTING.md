# 测试指南 - PDF.js 官方查看器 + 代理方案

## 测试步骤

### 1. 启动后端代理服务器

```bash
# 安装依赖（如果还没安装）
pip install flask flask-cors requests

# 启动代理服务器
python backend_proxy.py
```

预期输出：
```
============================================================
PDF 代理服务器
============================================================
服务地址: http://localhost:5000
代理端点: http://localhost:5000/pdf-proxy?url=PDF_URL
============================================================
按 Ctrl+C 停止服务器
============================================================
 * Running on http://0.0.0.0:5000
```

### 2. 测试代理服务器

在浏览器中访问：
```
http://localhost:5000/health
```

应该返回：
```json
{
  "status": "ok",
  "service": "PDF Proxy"
}
```

### 3. 启动前端应用

```bash
cd frontend
npm install  # 如果还没安装依赖
npm run dev
```

### 4. 测试 PDF 加载

1. 打开前端应用（通常是 http://localhost:3000）
2. 从左侧目录选择一个报告
3. 观察右侧是否显示 PDF.js 官方查看器
4. 测试查看器功能：
   - ✅ 页面导航
   - ✅ 缩放功能
   - ✅ 搜索功能
   - ✅ 下载功能
   - ✅ 打印功能

## 测试场景

### 场景 1：正常加载

**步骤**：
1. 确保代理服务器运行
2. 选择任意报告
3. 观察 PDF 是否正常显示

**预期结果**：
- ✅ PDF.js 查看器正常加载
- ✅ PDF 内容正确显示
- ✅ 所有功能可用

### 场景 2：代理服务器未运行

**步骤**：
1. 停止代理服务器
2. 选择报告

**预期结果**：
- ⚠️ 显示错误提示
- ⚠️ 提供"在新窗口打开"选项

### 场景 3：网络 PDF（如 pdf.dfcfw.com）

**步骤**：
1. 选择包含网络 PDF 链接的报告
2. 观察加载过程

**预期结果**：
- ✅ 通过代理成功加载
- ✅ 不受 CORS 限制
- ✅ 不受 X-Frame-Options 限制

### 场景 4：本地 PDF

**步骤**：
1. 将 PDF 放在 `frontend/public/pdfs/` 目录
2. 选择该 PDF

**预期结果**：
- ✅ 直接加载（不需要代理）
- ✅ 正常显示

## 调试技巧

### 查看浏览器控制台

打开浏览器开发者工具（F12），查看：
- Network 标签：检查代理请求是否成功
- Console 标签：查看是否有错误信息

### 查看代理服务器日志

代理服务器会输出请求日志：
```
[代理] 请求 PDF: https://pdf.dfcfw.com/...
```

### 测试代理端点

直接在浏览器中测试：
```
http://localhost:5000/pdf-proxy?url=https%3A%2F%2Fpdf.dfcfw.com%2Fpdf%2FH3_AP202510281770514161_1.pdf
```

应该直接下载或显示 PDF。

## 常见问题

### Q: PDF 显示空白

**A**: 检查：
1. 代理服务器是否运行
2. 浏览器控制台是否有错误
3. PDF URL 是否正确

### Q: 代理请求失败

**A**: 检查：
1. 网络连接
2. PDF 服务器是否可访问
3. 代理服务器日志中的错误信息

### Q: PDF.js 查看器无法加载

**A**: 检查：
1. 网络连接（需要访问 mozilla.github.io）
2. 浏览器是否阻止了第三方内容
3. 尝试使用本地 PDF.js（需要配置）

## 性能测试

### 测试大文件

1. 选择一个较大的 PDF 文件（>10MB）
2. 观察加载时间
3. 检查内存使用

### 测试并发

1. 快速切换多个报告
2. 观察是否有资源泄漏
3. 检查代理服务器性能

## 下一步

如果测试通过，可以：
1. 优化代理服务器性能
2. 添加缓存功能
3. 添加错误重试机制
4. 优化大文件处理

